language: go
go:
  - 1.13.7
env: "PATH=/home/travis/gopath/bin:$PATH"
before_install:
  - go get github.com/mattn/gom
script:
  - go vet -x ./...
  # Install dependencies via gom
  - $HOME/gopath/bin/gom -production install

  # Build linux/amd64 archive
  - export GOOS="linux"
  - export GOARCH="amd64"
  - gom build -v -tags "forceposix" -o build/linux-x64/cli-kintone
  - zip linux-x64.zip build/linux-x64/cli-kintone

  # Build darwin/amd64 archive
  - export GOOS="darwin"
  - export GOARCH="amd64"
  - gom build -v -tags "forceposix" -o build/macos-x64/cli-kintone
  - zip macos-x64.zip build/macos-x64/cli-kintone

  # Build windows/amd64 archive
  - export GOOS="windows"
  - export GOARCH="amd64"
  - gom build -v -tags "forceposix" -o build/windows-x64/cli-kintone.exe
  - zip windows-x64.zip build/windows-x64/cli-kintone.exe

deploy:
  provider: releases
  api_key: 
    secure: "EK+zhLvIX174XkFrstXsleqnOBKzbxsU3jszWQZ1thSqTXRr2qDxFiIhmH+GtMhr0ElvRQ9ux4dInwJ31OVToFgJWg9HJRZS+2k5VqehyDOagLII+INweUkljmg+Flqf/5XJjMAG98uZC0lMiqKOlt/qNF7jodBzSe4iZGsulb5OFHufZ73nG+JYJgCJnKmLSRLYYeU1HBjopRMyogZdrlhCVTsgESRCa29kV6fUqfVbh4ZbU76QP3shpHxvg3KdEB9g/aY1fNK+3FLT+627gOHhLCfd9rlTlW6nuh6lI812TCgZNLZBrYbDDi6pAa8Fu6m6DiPPyfw6HukOqjO61ptQWB3gJ0KL57z80wkmKLhAEB1q78O2HOD4iByrrLcnyPABng9XojliSKuObjKIjWGyWxvSdzfeBa9NmUn/65185WwvbwTCiQjZF5PLVizj7SkutTKeJrKAfZBtVgRb2jzO3Bsr+uqdo2njSxnG62ek3REFA1/NZmigt0haHEdKopQ1BDMSA26Cw3oyPNIAEDUEdL4R5SetgjhnW7QWgkrdOBX0H7lpg1ui/EQm5+MZy1CbQKslrByapPggn7dv0uzTP8tWc00mM3It7orZYS4efyw3IHAizht4XLK5O17McpXK+eujGbkdFMKFZ+OyH+mI8CYrNrb5K8n1qD5NDnI="
  file:
    - "linux-x64.zip"
    - "macos-x64.zip"
    - "windows-x64.zip"
  skip_cleanup: true
  all_branches: true  # https://github.com/travis-ci/travis-ci/issues/1675
  on:
    tags: true
